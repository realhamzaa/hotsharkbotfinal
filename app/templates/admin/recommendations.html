{% extends "base.html" %}

{% block title %}ุฅุฏุงุฑุฉ ุงูุชูุตูุงุช - HOT SHARK Admin{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="text-white mb-4">
            <i class="fas fa-chart-line"></i>
            ุฅุฏุงุฑุฉ ุงูุชูุตูุงุช
        </h1>
    </div>
</div>

<!-- Send New Recommendation Form -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-plus"></i>
                    ุฅุฑุณุงู ุชูุตูุฉ ุฌุฏูุฏุฉ
                </h5>
            </div>
            <div class="card-body">
                <form method="post" action="/admin/recommendations/send">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="asset_pair" class="form-label">ุฒูุฌ ุงูุนููุฉ:</label>
                                <select class="form-control" name="asset_pair" required>
                                    {% for pair in supported_pairs %}
                                    <option value="{{ pair }}">{{ pair }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="trade_type" class="form-label">ููุน ุงูุตููุฉ:</label>
                                <select class="form-control" name="trade_type" required>
                                    <option value="BUY">ุดุฑุงุก (BUY)</option>
                                    <option value="SELL">ุจูุน (SELL)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="entry_points" class="form-label">ููุงุท ุงูุฏุฎูู (ููุตููุฉ ุจูุงุตูุฉ):</label>
                                <input type="text" class="form-control" name="entry_points" 
                                       placeholder="1950.5, 1948.0" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="tp_levels" class="form-label">ุฃูุฏุงู ุงูุฑุจุญ (ููุตููุฉ ุจูุงุตูุฉ):</label>
                                <input type="text" class="form-control" name="tp_levels" 
                                       placeholder="1960.0, 1965.0" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="sl" class="form-label">ููู ุงูุฎุณุงุฑุฉ:</label>
                                <input type="number" step="0.01" class="form-control" name="sl" 
                                       placeholder="1945.0" required>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="pips" class="form-label">ุนุฏุฏ ุงูููุงุท:</label>
                                <input type="number" class="form-control" name="pips" 
                                       placeholder="150" required>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="success_rate" class="form-label">ูุณุจุฉ ุงููุฌุงุญ (%):</label>
                                <input type="number" step="0.1" class="form-control" name="success_rate" 
                                       placeholder="85.5">
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="trade_duration" class="form-label">ูุฏุฉ ุงูุตููุฉ:</label>
                                <select class="form-control" name="trade_duration" required>
                                    <option value="scalp">ุณูุงูุจ (Scalp)</option>
                                    <option value="short" selected>ูุตูุฑุฉ (Short)</option>
                                    <option value="long">ุทูููุฉ (Long)</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="rr_ratio" class="form-label">ูุณุจุฉ R:R:</label>
                                <input type="text" class="form-control" name="rr_ratio" 
                                       placeholder="1:2" value="1:2" required>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="lot_size_per_100" class="form-label">ุงูููุช ููู 100$:</label>
                                <input type="number" step="0.01" class="form-control" name="lot_size_per_100" 
                                       placeholder="0.01" value="0.01" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="strategy" class="form-label">ุงูุงุณุชุฑุงุชูุฌูุฉ (ุงุฎุชูุงุฑู):</label>
                                <input type="text" class="form-control" name="strategy" 
                                       placeholder="ICT_BOS, FVG, Liquidity_Sweep">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <div class="form-check mt-4">
                                    <input class="form-check-input" type="checkbox" name="is_premium" id="is_premium">
                                    <label class="form-check-label" for="is_premium">
                                        ๐ ุตููุฉ ูููุฒุฉ (Zero Drawdown)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="is_live" id="is_live" checked>
                                    <label class="form-check-label" for="is_live">
                                        ๐ด ุตููุฉ ูุจุงุดุฑุฉ (ุบูุฑ ูุนููุฉ)
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-paper-plane"></i>
                            ุฅุฑุณุงู ุงูุชูุตูุฉ ูุฌููุน ุงููุดุชุฑููู
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Recent Recommendations -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-history"></i>
                    ุงูุชูุตูุงุช ุงูุฃุฎูุฑุฉ
                </h5>
            </div>
            <div class="card-body">
                {% if recommendations %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>ุงููุนุฑู</th>
                                <th>ุงูุฒูุฌ</th>
                                <th>ุงูููุน</th>
                                <th>ููุงุท ุงูุฏุฎูู</th>
                                <th>TP</th>
                                <th>SL</th>
                                <th>ุงูููุงุท</th>
                                <th>ุงูุญุงูุฉ</th>
                                <th>ุงูุชุงุฑูุฎ</th>
                                <th>ุงูุฅุฌุฑุงุกุงุช</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for rec in recommendations %}
                            <tr>
                                <td>
                                    <strong>#{{ rec.id }}</strong>
                                    {% if rec.is_premium %}
                                    <span class="badge bg-warning">๐</span>
                                    {% endif %}
                                </td>
                                <td><strong>{{ rec.asset_pair }}</strong></td>
                                <td>
                                    <span class="badge {% if rec.trade_type == 'BUY' %}bg-success{% else %}bg-danger{% endif %}">
                                        {{ rec.trade_type }}
                                    </span>
                                </td>
                                <td>{{ rec.entry_points|replace('[', '')|replace(']', '')|replace('"', '') }}</td>
                                <td>{{ rec.tp|replace('[', '')|replace(']', '')|replace('"', '') }}</td>
                                <td>{{ rec.sl }}</td>
                                <td>{{ rec.pips }}</td>
                                <td>
                                    <span class="badge 
                                        {% if rec.status == 'active' %}bg-primary
                                        {% elif rec.status == 'tp_hit' %}bg-success
                                        {% elif rec.status == 'sl_hit' %}bg-danger
                                        {% else %}bg-secondary{% endif %}">
                                        {% if rec.status == 'active' %}ูุดุท
                                        {% elif rec.status == 'tp_hit' %}ุชู ุงููุฏู
                                        {% elif rec.status == 'sl_hit' %}ุถุฑุจ SL
                                        {% else %}{{ rec.status }}{% endif %}
                                    </span>
                                </td>
                                <td>{{ rec.sent_at.strftime('%Y-%m-%d %H:%M') }}</td>
                                <td>
                                    {% if rec.status == 'active' %}
                                    <div class="btn-group" role="group">
                                        <button type="button" class="btn btn-success btn-sm" 
                                                onclick="updateRecommendationStatus({{ rec.id }}, 'tp_hit')">
                                            <i class="fas fa-check"></i> TP
                                        </button>
                                        <button type="button" class="btn btn-danger btn-sm" 
                                                onclick="updateRecommendationStatus({{ rec.id }}, 'sl_hit')">
                                            <i class="fas fa-times"></i> SL
                                        </button>
                                    </div>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-chart-line fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">ูุง ุชูุฌุฏ ุชูุตูุงุช ุญุชู ุงูุขู</h5>
                    <p class="text-muted">ูู ุจุฅุฑุณุงู ุฃูู ุชูุตูุฉ ุจุงุณุชุฎุฏุงู ุงููููุฐุฌ ุฃุนูุงู</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function updateRecommendationStatus(recId, status) {
    if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุชุญุฏูุซ ุญุงูุฉ ูุฐู ุงูุชูุตูุฉุ')) {
        // In a real implementation, this would make an AJAX call to update the status
        // For now, we'll just show an alert
        alert('ุณูุชู ุชุญุฏูุซ ุญุงูุฉ ุงูุชูุตูุฉ #' + recId + ' ุฅูู ' + status);
        
        // You can implement the actual update logic here
        // fetch('/admin/recommendations/' + recId + '/update', {
        //     method: 'POST',
        //     headers: {'Content-Type': 'application/json'},
        //     body: JSON.stringify({status: status})
        // }).then(() => location.reload());
    }
}

// Auto-refresh every 30 seconds
setTimeout(function() {
    location.reload();
}, 30000);
</script>
{% endblock %}

